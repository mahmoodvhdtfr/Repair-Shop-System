<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงููพูุฑุช/ุงฺฉุณูพูุฑุช - ุณุณุชู ุชุนูุฑฺฏุงู</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>๐ค ูุฑู ุงูุฒุงุฑ ูุฏุฑุช ุชุนูุฑฺฏุงู ููุงุฒู ุฎุงูฺฏ ฺุงุจฺฉ ุงูฺฉุชุฑููฺฉ</h1>
            <nav>
                <a href="/" class="nav-link">๐ ุฏุงุดุจูุฑุฏ</a>
                <a href="/add-customer" class="nav-link">๐ค ุซุจุช ุฏุณุชฺฏุงู ุฌุฏุฏ</a>
                <a href="/customers" class="nav-link">๐ ูุณุช ูุดุชุฑุงู</a>
                <a href="/reports" class="nav-link">๐ ฺฏุฒุงุฑุดโูุง</a>
                <a href="/import-export" class="nav-link active">๐ค ุงููพูุฑุช/ุงฺฉุณูพูุฑุช</a>
            </nav>
        </header>

        <main>
            <div class="import-export-section">
                <div class="section-header">
                    <div class="header-icon">๐ค</div>
                    <h2>ุงููพูุฑุช ู ุงฺฉุณูพูุฑุช ุฏุงุฏูโูุง</h2>
                    <p>ูุงุฑุฏ ฺฉุฑุฏู ู ุฎุฑูุฌ ฺฏุฑูุชู ุงุทูุงุนุงุช ูุดุชุฑุงู ุงุฒ ูุงู ุงฺฉุณู</p>
                </div>

                <!-- ฺฉุงุฑุชโูุง ุนููุงุช -->
                <div class="operation-cards">
                    <!-- ุงููพูุฑุช -->
                    <div class="operation-card">
                        <div class="card-header">
                            <div class="card-icon">๐ฅ</div>
                            <h3>ุงููพูุฑุช ุงุฒ ุงฺฉุณู</h3>
                        </div>
                        
                        <div class="card-description">
                            ุงุทูุงุนุงุช ูุดุชุฑุงู ุฑุง ุงุฒ ูุงู ุงฺฉุณู ูุงุฑุฏ ุณุณุชู ฺฉูุฏ. ูุฑูุช ูุงู ุจุงุฏ xlsx ุง xls ุจุงุดุฏ.
                        </div>

                        <form id="importForm" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="file" class="form-label">๐ ุงูุชุฎุงุจ ูุงู ุงฺฉุณู:</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="file" name="file" accept=".xlsx,.xls" required 
                                           class="file-input" onchange="showFileInfo()">
                                    <button type="button" class="file-browse-btn" onclick="document.getElementById('file').click()">
                                        ๐ ุงูุชุฎุงุจ ูุงู
                                    </button>
                                </div>
                                <div id="fileInfo" class="file-info" style="display: none;">
                                    <h4>๐ ุงุทูุงุนุงุช ูุงู:</h4>
                                    <div class="file-details">
                                        <div class="file-detail">
                                            <span>๐ ูุงู:</span>
                                            <span id="fileName">-</span>
                                        </div>
                                        <div class="file-detail">
                                            <span>๐ฆ ุญุฌู:</span>
                                            <span id="fileSize">-</span>
                                        </div>
                                        <div class="file-detail">
                                            <span>๐ ููุน:</span>
                                            <span id="fileType">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-success btn-large">
                                <span class="btn-icon">๐</span>
                                ุดุฑูุน ุงููพูุฑุช
                            </button>
                        </form>

                        <div id="importProgress" class="progress-section" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div class="progress-text" id="progressText">ุฏุฑ ุญุงู ูพุฑุฏุงุฒุด...</div>
                        </div>
                    </div>

                    <!-- ุงฺฉุณูพูุฑุช -->
                    <div class="operation-card">
                        <div class="card-header">
                            <div class="card-icon">๐ค</div>
                            <h3>ุงฺฉุณูพูุฑุช ุจู ุงฺฉุณู</h3>
                        </div>
                        
                        <div class="card-description">
                            ุฏุฑุงูุช ฺฏุฒุงุฑุด ฺฉุงูู ุงุทูุงุนุงุช ูุดุชุฑุงู ุฏุฑ ูุงูุจ ูุงู ุงฺฉุณู. ุงู ฺฏุฒุงุฑุด ุดุงูู ุชูุงู ุงุทูุงุนุงุช ุซุจุช ุดุฏู ูโุจุงุดุฏ.
                        </div>

                        <div style="margin-top: 30px;">
                            <a href="/api/export-excel" class="btn btn-primary btn-large">
                                <span class="btn-icon">๐พ</span>
                                ุฏุงูููุฏ ฺฏุฒุงุฑุด ุงฺฉุณู
                            </a>
                        </div>

                        <div class="file-info" style="margin-top: 25px;">
                            <h4>๐ ุงุทูุงุนุงุช ฺฏุฒุงุฑุด:</h4>
                            <div class="file-details">
                                <div class="file-detail">
                                    <span>๐ ูุฑูุช:</span>
                                    <span>Excel (.xlsx)</span>
                                </div>
                                <div class="file-detail">
                                    <span>๐ ุดุงูู:</span>
                                    <span>ุชูุงู ุงุทูุงุนุงุช ูุดุชุฑุงู</span>
                                </div>
                                <div class="file-detail">
                                    <span>๐ ุจูโุฑูุฒุฑุณุงู:</span>
                                    <span>ุขุฎุฑู ุชุบุฑุงุช</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ุฑุงูููุง ุงุณุชูุงุฏู -->
                <div class="help-section">
                    <div class="help-header">
                        <div class="help-icon">โ</div>
                        <h3>ุฑุงูููุง ุงุณุชูุงุฏู</h3>
                    </div>
                    
                    <div class="help-content">
                        <div class="help-item">
                            <div class="help-item-icon">๐ฅ</div>
                            <div class="help-item-content">
                                <h4>ุงููพูุฑุช ุฏุงุฏูโูุง</h4>
                                <p>ูุงู ุงฺฉุณู ุจุงุฏ ุดุงูู ุณุชููโูุง: ูุงู ูุดุชุฑุ ุดูุงุฑู ุชูุงุณุ ุชุงุฑุฎ ูุฑูุฏุ ฺฉุฏ ูุณููุ ููุน ูุณููุ ููุช ุฌูุณ ู ุฏุณุชูุฒุฏ ุฎุฏูุงุช ุจุงุดุฏ.</p>
                            </div>
                        </div>
                        
                        <div class="help-item">
                            <div class="help-item-icon">๐ค</div>
                            <div class="help-item-content">
                                <h4>ุงฺฉุณูพูุฑุช ุฏุงุฏูโูุง</h4>
                                <p>ฺฏุฒุงุฑุด ุชููุฏ ุดุฏู ุดุงูู ุชูุงู ุงุทูุงุนุงุช ุซุจุช ุดุฏู ุฏุฑ ุณุณุชู ูโุจุงุดุฏ ู ูโุชูุงูุฏ ุขู ุฑุง ุฏุฑ ุงฺฉุณู ูุฑุงุด ฺฉูุฏ.</p>
                            </div>
                        </div>
                        
                        <div class="help-item">
                            <div class="help-item-icon">โ๏ธ</div>
                            <div class="help-item-content">
                                <h4>ููุงุญุธุงุช ููู</h4>
                                <p>ุฏุฑ ููฺฏุงู ุงููพูุฑุชุ ุงุทูุงุนุงุช ุชฺฉุฑุงุฑ ุจุฑุฑุณ ูโุดููุฏ. ุงุฒ ูุฑูุช ุงุณุชุงูุฏุงุฑุฏ ุชุงุฑุฎ (1403/01/01) ุงุณุชูุงุฏู ฺฉูุฏ.</p>
                            </div>
                        </div>
                        
                        <div class="help-item">
                            <div class="help-item-icon">๐ก</div>
                            <div class="help-item-content">
                                <h4>ูพุดุชุจุงู ูุฑูุช</h4>
                                <p>ูุงูโูุง ุจุง ูพุณููุฏ xlsx ู xls ูพุดุชุจุงู ูโุดููุฏ. ุจุฑุง ุจูุชุฑู ูุชุฌู ุงุฒ ุขุฎุฑู ูุณุฎู ุงฺฉุณู ุงุณุชูุงุฏู ฺฉูุฏ.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ููุงุด ุงุทูุงุนุงุช ูุงู
        function showFileInfo() {
            const fileInput = document.getElementById('file');
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const fileType = document.getElementById('fileType');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                fileType.textContent = file.type || 'Excel File';
                fileInfo.style.display = 'block';
            } else {
                fileInfo.style.display = 'none';
            }
        }

        // ูุฑูุช ุณุงุฒ ูุงู
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // ูุฏุฑุช ูุฑู ุงููพูุฑุช
        document.getElementById('importForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('file');
            const submitBtn = this.querySelector('button[type="submit"]');
            const progressSection = document.getElementById('importProgress');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            if (!fileInput.files.length) {
                showAlert('ูุทูุงู ฺฉ ูุงู ุงูุชุฎุงุจ ฺฉูุฏ', 'error');
                return;
            }

            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<span class="btn-icon">โณ</span> ุฏุฑ ุญุงู ุงููพูุฑุช...';
            submitBtn.disabled = true;
            progressSection.style.display = 'block';
            
            // ุดุจูโุณุงุฒ ูพุดุฑูุช
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 90) progress = 90;
                progressFill.style.width = progress + '%';
                progressText.textContent = `ุฏุฑ ุญุงู ูพุฑุฏุงุฒุด... ${Math.round(progress)}%`;
            }, 200);

            try {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);

                const response = await fetch('/api/import-excel', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                clearInterval(progressInterval);
                progressFill.style.width = '100%';
                progressText.textContent = 'ุชฺฉูู ุดุฏ!';

                if (result.success) {
                    showAlert(`โ ${result.message}`, 'success');
                    // ุฑุณุช ูุฑู
                    setTimeout(() => {
                        fileInput.value = '';
                        document.getElementById('fileInfo').style.display = 'none';
                        progressSection.style.display = 'none';
                    }, 2000);
                } else {
                    showAlert(`โ ${result.message}`, 'error');
                }
            } catch (error) {
                clearInterval(progressInterval);
                console.error('Error:', error);
                showAlert('โ ุฎุทุง ุฏุฑ ุงุฑุชุจุงุท ุจุง ุณุฑูุฑ', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // ููุงุด ูพุงู
        function showAlert(message, type) {
            const existingAlerts = document.querySelectorAll('.custom-alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `custom-alert alert-${type}`;
            alertDiv.innerHTML = `
                <div class="alert-content">
                    <span class="alert-icon">${type === 'success' ? 'โ' : 'โ'}</span>
                    <span class="alert-message">${message}</span>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                alertDiv.classList.remove('show');
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.parentNode.removeChild(alertDiv);
                    }
                }, 300);
            }, 5000);
        }

        // ุจุงุฑฺฏุฐุงุฑ ุงููู
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ุตูุญู ุงููพูุฑุช/ุงฺฉุณูพูุฑุช ุขูุงุฏู ุงุณุช');
        });
    </script>
</body>
<!-- ููุชุฑ ุณุงุฏู - ฺฉุฏ ุงู ูุณูุช ุฑุง ุฏุฑ ุงูุชูุง body ููู ุตูุญุงุช ูุฑุงุฑ ุฏูุฏ -->
<footer class="simple-footer">
    <div class="footer-content">
        <div class="footer-text">
            <span class="version">ูุณุฎู ฑ.ฐ - ูุฎุตูุต ุงุณุชูุงุฏู ูุญู</span>
            <span class="separator">|</span>
            <span class="developer">
                ุจุฑูุงูู ููุณ: 
                <a href="mailto:m.vahdatfar@gmail.com" class="developer-link">
                    ูุญููุฏ ูุญุฏุช ูุฑ
                </a>
            </span>
        </div>
    </div>
</footer>
</html>