<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Ø«Ø¨Øª Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¬Ø¯ÛŒØ¯ - Ø³ÛŒØ³ØªÙ… ØªØ¹Ù…ÛŒØ±Ú¯Ø§Ù‡</title>
	<link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ‘¤ Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¹Ù…ÛŒØ±Ú¯Ø§Ù‡ Ù„ÙˆØ§Ø²Ù… Ø®Ø§Ù†Ú¯ÛŒ</h1>
            <nav>
                <a href="/" class="nav-link">ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
                <a href="/add-customer" class="nav-link active">ğŸ‘¤  Ø«Ø¨Øª Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¬Ø¯ÛŒØ¯</a>
                <a href="/customers" class="nav-link">ğŸ“‹ Ù„ÛŒØ³Øª Ù…Ø´ØªØ±ÛŒØ§Ù†</a>
                <a href="/reports" class="nav-link">ğŸ“ˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</a>
                <a href="/import-export" class="nav-link">ğŸ“¤ Ø§ÛŒÙ…Ù¾ÙˆØ±Øª/Ø§Ú©Ø³Ù¾ÙˆØ±Øª</a>
            </nav>
        </header>

        <main>
            <div class="add-customer-section">
                <div class="section-header">
                    <div class="header-icon">â•</div>
                    <h2> Ø«Ø¨Øª Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¬Ø¯ÛŒØ¯</h2>
                    <p>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒ Ùˆ Ø¯Ø³ØªÚ¯Ø§Ù‡ ØªØ¹Ù…ÛŒØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
                </div>

                <div class="form-container">
                    <form id="customerForm" method="POST">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="full_name" class="form-label">
                                    <span class="label-icon">ğŸ‘¤</span>
                                    Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ
                                </label>
                                <input type="text" id="full_name" name="full_name" 
                                       class="form-input" required 
                                       placeholder="Ù†Ø§Ù… Ú©Ø§Ù…Ù„ Ù…Ø´ØªØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
                            </div>

                            <div class="form-group">
                                <label for="phone_number" class="form-label">
                                    <span class="label-icon">ğŸ“</span>
                                    Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³
                                </label>
                                <input type="tel" id="phone_number" name="phone_number" 
                                       class="form-input" required 
                                       placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ Ù…Ø´ØªØ±ÛŒ">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="entry_date" class="form-label">
                                    <span class="label-icon">ğŸ“…</span>
                                    ØªØ§Ø±ÛŒØ® ÙˆØ±ÙˆØ¯
                                </label>
                                <div class="date-input-wrapper">
                                    <input type="text" id="entry_date" name="entry_date" required 
                                           class="date-input"
                                           placeholder="1403/10/01"
                                           readonly
                                           onfocus="showPersianCalendar('entry_date')">
                                    <button type="button" class="datepicker-btn" onclick="showPersianCalendar('entry_date')">
                                        ğŸ“…
                                    </button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="exit_date" class="form-label">
                                    <span class="label-icon">ğŸ“…</span>
                                    ØªØ§Ø±ÛŒØ® Ø®Ø±ÙˆØ¬
                                </label>
                                <div class="date-input-wrapper">
                                    <input type="text" id="exit_date" name="exit_date" 
                                           class="date-input"
                                           placeholder="Ø§Ø®ØªÛŒØ§Ø±ÛŒ - 1403/10/15"
                                           readonly
                                           onfocus="showPersianCalendar('exit_date')">
                                    <button type="button" class="datepicker-btn" onclick="showPersianCalendar('exit_date')">
                                        ğŸ“…
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="device_code" class="form-label">
                                    <span class="label-icon">ğŸ·ï¸</span>
                                    Ú©Ø¯ ÙˆØ³ÛŒÙ„Ù‡
                                </label>
                                <input type="text" id="device_code" name="device_code" 
                                       class="form-input" required 
                                       placeholder="Ú©Ø¯ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø³ØªÚ¯Ø§Ù‡">
                            </div>

                            <div class="form-group">
                                <label for="device_type" class="form-label">
                                    <span class="label-icon">ğŸ”§</span>
                                    Ù†ÙˆØ¹ ÙˆØ³ÛŒÙ„Ù‡
                                </label>
                                <input type="text" id="device_type" name="device_type" 
                                       class="form-input" required 
                                       placeholder="Ù†ÙˆØ¹ Ø¯Ø³ØªÚ¯Ø§Ù‡ (Ù…Ø«Ø§Ù„: Ø§ØªÙˆØŒ Ø³Ø´ÙˆØ§Ø±ØŒ Ù¾Ù†Ú©Ù‡)">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="material_cost" class="form-label">
                                    <span class="label-icon">ğŸ’°</span>
                                    Ù‚ÛŒÙ…Øª Ø¬Ù†Ø³ (ØªÙˆÙ…Ø§Ù†)
                                </label>
                                <input type="number" id="material_cost" name="material_cost" 
                                       class="form-input" 
                                       placeholder="0"
                                       value="0">
                            </div>

                            <div class="form-group">
                                <label for="service_cost" class="form-label">
                                    <span class="label-icon">ğŸ’¼</span>
                                    Ø¯Ø³ØªÙ…Ø²Ø¯ Ø®Ø¯Ù…Ø§Øª (ØªÙˆÙ…Ø§Ù†)
                                </label>
                                <input type="number" id="service_cost" name="service_cost" 
                                       class="form-input" 
                                       placeholder="0"
                                       value="0">
                            </div>
                        </div>

                        <div class="form-group full-width">
                            <label for="description" class="form-label">
                                <span class="label-icon">ğŸ“</span>
                                ØªÙˆØ¶ÛŒØ­Ø§Øª
                            </label>
                            <textarea id="description" name="description" 
                                      class="form-input" 
                                      placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ØªØ¹Ù…ÛŒØ± Ùˆ Ù…Ø´Ú©Ù„Ø§Øª Ø¯Ø³ØªÚ¯Ø§Ù‡..."></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-success btn-large">
                                <span class="btn-icon">ğŸ’¾</span>
                                Ø«Ø¨Øª Ù…Ø´ØªØ±ÛŒ
                            </button>
                            <button type="button" onclick="clearForm()" class="btn btn-secondary btn-large">
                                <span class="btn-icon">ğŸ—‘ï¸</span>
                                Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- ØªÙ‚ÙˆÛŒÙ… ÙØ§Ø±Ø³ÛŒ -->
    <div id="persianCalendar" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“… ØªÙ‚ÙˆÛŒÙ… ÙØ§Ø±Ø³ÛŒ</h2>
                <button class="close" onclick="hidePersianCalendar()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="calendar-controls">
                    <button class="calendar-nav-btn" onclick="changeCalendarMonth(-1)">â€¹ Ù…Ø§Ù‡ Ù‚Ø¨Ù„</button>
                    <span id="calendarMonthYear" class="calendar-month">Ø¯ÛŒ 1403</span>
                    <button class="calendar-nav-btn" onclick="changeCalendarMonth(1)">Ù…Ø§Ù‡ Ø¨Ø¹Ø¯ â€º</button>
                </div>
                <div class="calendar-weekdays">
                    <div>Ø´</div>
                    <div>ÛŒ</div>
                    <div>Ø¯</div>
                    <div>Ø³</div>
                    <div>Ú†</div>
                    <div>Ù¾</div>
                    <div>Ø¬</div>
                </div>
                <div id="calendarDays" class="calendar-days"></div>
                <div class="calendar-actions">
                    <button onclick="setCalendarToday()" class="btn btn-secondary">Ø§Ù…Ø±ÙˆØ²</button>
                    <button onclick="hidePersianCalendar()" class="btn btn-primary">Ø¨Ø³ØªÙ†</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ ØªÙ‚ÙˆÛŒÙ… ÙØ§Ø±Ø³ÛŒ
        let currentDateField = null;
        let calendarYear, calendarMonth, calendarDay;
        const persianMonths = [
            'ÙØ±ÙˆØ±Ø¯ÛŒÙ†', 'Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª', 'Ø®Ø±Ø¯Ø§Ø¯', 'ØªÛŒØ±', 'Ù…Ø±Ø¯Ø§Ø¯', 'Ø´Ù‡Ø±ÛŒÙˆØ±',
            'Ù…Ù‡Ø±', 'Ø¢Ø¨Ø§Ù†', 'Ø¢Ø°Ø±', 'Ø¯ÛŒ', 'Ø¨Ù‡Ù…Ù†', 'Ø§Ø³ÙÙ†Ø¯'
        ];

        // Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø¯Ù‚ÛŒÙ‚ ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ù‡ Ø´Ù…Ø³ÛŒ
        function gregorianToJalali(gy, gm, gd) {
            let g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
            let jy = (gy <= 1600) ? 0 : 979;
            gy -= (gy <= 1600) ? 621 : 1600;
            let gy2 = (gm > 2) ? (gy + 1) : gy;
            let days = (365 * gy) + (parseInt((gy2 + 3) / 4)) - (parseInt((gy2 + 99) / 100)) 
                     + (parseInt((gy2 + 399) / 400)) - 80 + gd + g_d_m[gm - 1];
            jy += 33 * (parseInt(days / 12053));
            days %= 12053;
            jy += 4 * (parseInt(days / 1461));
            days %= 1461;
            jy += parseInt((days - 1) / 365);
            if (days > 365) days = (days - 1) % 365;
            let jm = (days < 186) ? 1 + parseInt(days / 31) : 7 + parseInt((days - 186) / 30);
            let jd = 1 + ((days < 186) ? (days % 31) : ((days - 186) % 30));
            return [jy, jm, jd];
        }

        // Ú¯Ø±ÙØªÙ† ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø¨Ù‡ Ø´Ù…Ø³ÛŒ
        function getTodayJalali() {
            const today = new Date();
            const [jy, jm, jd] = gregorianToJalali(
                today.getFullYear(), 
                today.getMonth() + 1, 
                today.getDate()
            );
            return { year: jy, month: jm, day: jd };
        }

        // Ù†Ù…Ø§ÛŒØ´ ØªÙ‚ÙˆÛŒÙ… ÙØ§Ø±Ø³ÛŒ
        function showPersianCalendar(fieldId) {
            currentDateField = fieldId;
            
            // ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® ÙØ¹Ù„ÛŒ
            const today = getTodayJalali();
            calendarYear = today.year;
            calendarMonth = today.month;
            calendarDay = today.day;
            
            // Ø§Ú¯Ø± ÙÛŒÙ„Ø¯ Ù…Ù‚Ø¯Ø§Ø± Ø¯Ø§Ø±Ø¯ØŒ Ø§Ø² Ø¢Ù† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
            const currentValue = document.getElementById(fieldId).value;
            if (currentValue) {
                const parts = currentValue.split('/');
                if (parts.length === 3) {
                    calendarYear = parseInt(parts[0]);
                    calendarMonth = parseInt(parts[1]);
                    calendarDay = parseInt(parts[2]);
                }
            }
            
            renderPersianCalendar();
            document.getElementById('persianCalendar').style.display = 'block';
            document.body.classList.add('modal-open');
        }

        function hidePersianCalendar() {
            document.getElementById('persianCalendar').style.display = 'none';
            document.body.classList.remove('modal-open');
            currentDateField = null;
        }

        function changeCalendarMonth(direction) {
            calendarMonth += direction;
            if (calendarMonth > 12) {
                calendarMonth = 1;
                calendarYear++;
            } else if (calendarMonth < 1) {
                calendarMonth = 12;
                calendarYear--;
            }
            renderPersianCalendar();
        }

        function renderPersianCalendar() {
            const monthYearElement = document.getElementById('calendarMonthYear');
            const daysElement = document.getElementById('calendarDays');
            
            monthYearElement.textContent = `${persianMonths[calendarMonth - 1]} ${calendarYear}`;
            daysElement.innerHTML = '';
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù‡
            const daysInMonth = (calendarMonth <= 6) ? 31 : 30;
            const actualDaysInMonth = (calendarMonth === 12 && !isLeapYear(calendarYear)) ? 29 : daysInMonth;
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ² Ø§ÙˆÙ„ Ù…Ø§Ù‡
            const firstDay = getFirstDayOfMonth(calendarYear, calendarMonth);
            const today = getTodayJalali();
            
            // Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ø±ÙˆØ² Ø§ÙˆÙ„
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                daysElement.appendChild(emptyDay);
            }
            
            // Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø§Ù‡
            for (let day = 1; day <= actualDaysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                dayElement.onclick = function() {
                    selectCalendarDate(day);
                };
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ø§Ù…Ø±ÙˆØ² Ø§Ø³Øª
                if (calendarYear === today.year && calendarMonth === today.month && day === today.day) {
                    dayElement.classList.add('today');
                }
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ø±ÙˆØ² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡ Ø§Ø³Øª
                if (calendarDay === day) {
                    dayElement.classList.add('selected');
                }
                
                daysElement.appendChild(dayElement);
            }
        }

        // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ù„ Ú©Ø¨ÛŒØ³Ù‡
        function isLeapYear(jy) {
            const remains = [1, 5, 9, 13, 17, 22, 26, 30];
            return remains.includes(jy % 33);
        }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÙˆØ² Ø§ÙˆÙ„ Ù…Ø§Ù‡
        function getFirstDayOfMonth(jy, jm) {
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø§Ø¯Ù‡ - Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±ÛŒ Ø¯Ø§Ø±Ø¯
            return (jm * 2) % 7;
        }

        function selectCalendarDate(day) {
            calendarDay = day;
            const selectedDate = `${calendarYear}/${calendarMonth.toString().padStart(2, '0')}/${day.toString().padStart(2, '0')}`;
            document.getElementById(currentDateField).value = selectedDate;
            hidePersianCalendar();
        }

        function setCalendarToday() {
            const today = getTodayJalali();
            calendarYear = today.year;
            calendarMonth = today.month;
            calendarDay = today.day;
            selectCalendarDate(calendarDay);
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±Ù…
        document.getElementById('customerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<span class="btn-icon">â³</span> Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª...';
            submitBtn.disabled = true;

            try {
                const formData = new FormData(this);
                
                const response = await fetch('/add-customer', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('âœ… Ù…Ø´ØªØ±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯', 'success');
                    clearForm();
                } else {
                    showAlert('âŒ ' + result.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
        function clearForm() {
            document.getElementById('customerForm').reset();
            // ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ø¨Ø±Ø§ÛŒ ØªØ§Ø±ÛŒØ® ÙˆØ±ÙˆØ¯
            const today = getTodayJalali();
            const todayString = `${today.year}/${today.month.toString().padStart(2, '0')}/${today.day.toString().padStart(2, '0')}`;
            document.getElementById('entry_date').value = todayString;
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        function showAlert(message, type) {
            const existingAlerts = document.querySelectorAll('.custom-alert');
            existingAlerts.forEach(alert => alert.remove());
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `custom-alert alert-${type}`;
            alertDiv.innerHTML = `
                <div class="alert-content">
                    <span class="alert-icon">${type === 'success' ? 'âœ…' : 'âŒ'}</span>
                    <span class="alert-message">${message}</span>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                alertDiv.classList.remove('show');
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.parentNode.removeChild(alertDiv);
                    }
                }, 300);
            }, 5000);
        }

        // Ø¨Ø³ØªÙ† modal Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø®Ø§Ø±Ø¬
        window.onclick = function(event) {
            const modal = document.getElementById('persianCalendar');
            if (event.target == modal) {
                hidePersianCalendar();
            }
        }

        // Ø¨Ø³ØªÙ† Ø¨Ø§ Ú©Ù„ÛŒØ¯ ESC
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                hidePersianCalendar();
            }
        });

        // ØªÙ†Ø¸ÛŒÙ… ØªØ§Ø±ÛŒØ® Ø§Ù…Ø±ÙˆØ² Ù‡Ù†Ú¯Ø§Ù… Ù„ÙˆØ¯ ØµÙØ­Ù‡
        document.addEventListener('DOMContentLoaded', function() {
            const today = getTodayJalali();
            const todayString = `${today.year}/${today.month.toString().padStart(2, '0')}/${today.day.toString().padStart(2, '0')}`;
            document.getElementById('entry_date').value = todayString;
        });
    </script>
</body>
<!-- ÙÙˆØªØ± Ø³Ø§Ø¯Ù‡ - Ú©Ø¯ Ø§ÛŒÙ† Ù‚Ø³Ù…Øª Ø±Ø§ Ø¯Ø± Ø§Ù†ØªÙ‡Ø§ÛŒ body Ù‡Ù…Ù‡ ØµÙØ­Ø§Øª Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯ -->
<footer class="simple-footer">
    <div class="footer-content">
        <div class="footer-text">
            <span class="version">Ù†Ø³Ø®Ù‡ Û±.Û° - Ù…Ø®ØµÙˆØµ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ø­Ù„ÛŒ</span>
            <span class="separator">|</span>
            <span class="developer">
                Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³: 
                <a href="mailto:m.vahdatfar@gmail.com" class="developer-link">
                    Ù…Ø­Ù…ÙˆØ¯ ÙˆØ­Ø¯Øª ÙØ±
                </a>
            </span>
        </div>
    </div>
</footer>
</html>